<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cinema Booking — Demo</title>
  <style>
    :root{ --bg:#0f172a; --card:#111827; --accent:#06b6d4; --muted:#94a3b8; --success:#10b981; --danger:#ef4444 }
    *{box-sizing:border-box;font-family:Inter, Roboto, system-ui, -apple-system, sans-serif}
    body{margin:0;background:linear-gradient(180deg,#071133 0%, #0f172a 100%);color:#e6eef6;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:28px}
    .app{width:980px;max-width:98%;}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,.6)}

    .controls{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    select,input[type=number]{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;color:#062027;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}

    .layout{display:grid;grid-template-columns:1fr 320px;gap:14px}
    .seatmap{padding:12px}
    .rows{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;gap:8px;align-items:center}
    .row .label{width:22px;color:var(--muted);font-size:13px}
    .seat{width:36px;height:36px;border-radius:8px;background:#0b1320;border:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer}
    .seat.booked{background:#162029;color:#9aa9b3;cursor:not-allowed;opacity:0.6}
    .seat.selected{outline:3px solid rgba(6,182,212,0.18);box-shadow:0 6px 14px rgba(2,6,23,.6)}
    .legend{display:flex;gap:8px;margin-top:10px}
    .legend span{display:inline-flex;align-items:center;gap:6px;font-size:13px;color:var(--muted)}
    .legend .box{width:14px;height:14px;border-radius:3px;display:inline-block}

    .sidebar{display:flex;flex-direction:column;gap:10px}
    .bookings{margin-top:8px}
    .ticket{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px}
    .actions{display:flex;gap:8px}

    footer{margin-top:12px;color:var(--muted);font-size:13px}
    @media(max-width:920px){.layout{grid-template-columns:1fr}} 
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="card" style="padding:12px 14px;display:flex;align-items:center;gap:12px">
        <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='36' height='36' rx='8' fill='%2306b6d4'/><text x='50%' y='52%' text-anchor='middle' fill='%23012227' font-family='Arial' font-size='18'>CB</text></svg>" alt="logo" style="border-radius:8px;"/>
        <div>
          <h1>Cinema Booking — Demo</h1>
          <div class="muted">Select movie, showtime & seats. Cancellation produces a refund.</div>
        </div>
      </div>
    </header>

    <div class="card layout">
      <main>
        <section class="controls">
          <label>
            Movie
            <select id="movieSelect"></select>
          </label>
          <label>
            Showtime
            <select id="showtimeSelect"></select>
          </label>
          <label>
            Price
            <input type="number" id="priceInput" value="250" min="0" />
          </label>
          <button id="resetBtn" class="ghost">Reset</button>
        </section>

        <section class="seatmap card">
          <h3 style="margin-top:0">Seat Map</h3>
          <div class="rows" id="seatRows"></div>
          <div class="legend">
            <span><i class="box" style="background:#0b1320;border:1px solid rgba(255,255,255,0.03)"></i> Available</span>
            <span><i class="box" style="background:#162029"></i> Booked</span>
            <span><i class="box" style="background:transparent;border:2px solid rgba(6,182,212,0.3)"></i> Selected</span>
          </div>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <button id="bookBtn">Book Selected</button>
            <div class="muted">Selected: <span id="selectedCount">0</span></div>
          </div>
        </section>
      </main>

      <aside class="sidebar">
        <div class="card" style="padding:12px">
          <div class="small muted">Active bookings</div>
          <div id="bookingsList" class="bookings"></div>
        </div>

        <div class="card" style="padding:12px">
          <div class="small muted">System log</div>
          <div id="log" class="muted" style="height:120px;overflow:auto;margin-top:8px"></div>
        </div>
      </aside>
    </div>

    <footer class="muted">Demo only — in-memory booking. Refresh clears state.</footer>
  </div>

  <script>
    // --- Simple in-memory model ---
    class Movie{constructor(id,title){this.id=id;this.title=title}}

    class Theater{
      constructor(rows=5, seatsPerRow=8){
        this.rows=rows;this.seatsPerRow=seatsPerRow;this.baseSeats=this._generateSeatIds();
        // availability: { showtime: { seatId: boolean } }
        this.availability={};
      }
      _generateSeatIds(){
        const seats=[];
        for(let r=0;r<this.rows;r++){
          const letter=String.fromCharCode(65+r);
          for(let s=1;s<=this.seatsPerRow;s++) seats.push(`${letter}${s}`);
        }
        return seats;
      }
      initShow(showtime){
        if(!this.availability[showtime]){
          this.availability[showtime]={};
          this.baseSeats.forEach(id=>this.availability[showtime][id]=true);
        }
      }
      isSeatAvailable(showtime,seatId){this.initShow(showtime);if(!(seatId in this.availability[showtime])) throw new Error('Invalid seat');return this.availability[showtime][seatId];}
      markBooked(showtime,seatId){this.initShow(showtime);if(!this.isSeatAvailable(showtime,seatId)) throw new Error('SeatAlreadyBooked');this.availability[showtime][seatId]=false}
      markAvailable(showtime,seatId){this.initShow(showtime);if(this.availability[showtime][seatId]) throw new Error('SeatNotBooked');this.availability[showtime][seatId]=true}
    }

    class BookingManager{
      constructor(theater){this.theater=theater;this.tickets={};this.counter=1}
      book(movie,showtime,seatIds,userId,price){
        // atomic-like: check all seats first
        for(const s of seatIds){if(!this.theater.isSeatAvailable(showtime,s)) throw new Error('SeatAlreadyBooked: '+s)}
        const created=[];
        for(const s of seatIds){this.theater.markBooked(showtime,s);const ticket={id:'T'+(this.counter++),movie,showtime,seatId:s,userId,price,status:'ACTIVE'};this.tickets[ticket.id]=ticket;created.push(ticket)}
        return created;
      }
      cancel(ticketId){
        const t=this.tickets[ticketId];if(!t) throw new Error('InvalidTicket');if(t.status==='CANCELLED') throw new Error('AlreadyCancelled');
        this.theater.markAvailable(t.showtime,t.seatId);t.status='CANCELLED';return t.price; // full refund
      }
      activeTickets(){return Object.values(this.tickets).filter(t=>t.status==='ACTIVE')}
    }

    // --- bootstrap demo data ---
    const movies=[new Movie(1,'Interstellar'),new Movie(2,'The Matrix'),new Movie(3,'Inception')];
    const showtimes=['2025-10-30 18:00','2025-10-30 21:00','2025-10-31 15:00'];
    const theater=new Theater(4,7); // 4 rows x 7 seats
    const manager=new BookingManager(theater);

    // --- UI wiring ---
    const movieSelect=document.getElementById('movieSelect');
    const showtimeSelect=document.getElementById('showtimeSelect');
    const seatRowsEl=document.getElementById('seatRows');
    const selectedCountEl=document.getElementById('selectedCount');
    const bookBtn=document.getElementById('bookBtn');
    const bookingsList=document.getElementById('bookingsList');
    const logEl=document.getElementById('log');
    const priceInput=document.getElementById('priceInput');
    const resetBtn=document.getElementById('resetBtn');

    function log(msg){const p=document.createElement('div');p.textContent=new Date().toLocaleTimeString()+': '+msg;logEl.prepend(p)}

    function populateControls(){
      movies.forEach(m=>{const opt=document.createElement('option');opt.value=m.id;opt.textContent=m.title;movieSelect.appendChild(opt)});
      showtimes.forEach(s=>{const opt=document.createElement('option');opt.value=s;opt.textContent=s;showtimeSelect.appendChild(opt)});
    }

    // render seat map for current showtime
    let selectedSeats=new Set();
    function renderSeatMap(){
      const showtime=showtimeSelect.value;theater.initShow(showtime);
      selectedSeats.clear();
      seatRowsEl.innerHTML='';
      const rows=theater.rows;const sp=theater.seatsPerRow;
      for(let r=0;r<rows;r++){
        const rowDiv=document.createElement('div');rowDiv.className='row';
        const label=document.createElement('div');label.className='label';label.textContent=String.fromCharCode(65+r);
        rowDiv.appendChild(label);
        for(let s=1;s<=sp;s++){
          const id=String.fromCharCode(65+r)+s;
          const btn=document.createElement('button');btn.className='seat';btn.textContent=s;btn.dataset.seat=id;
          if(!theater.isSeatAvailable(showtime,id)) btn.classList.add('booked');
          btn.addEventListener('click',(e)=>{
            if(btn.classList.contains('booked')) return; // cannot select booked
            if(btn.classList.contains('selected')){btn.classList.remove('selected');selectedSeats.delete(id)} else {btn.classList.add('selected');selectedSeats.add(id)}
            updateSelectedCount();
          });
          rowDiv.appendChild(btn);
        }
        seatRowsEl.appendChild(rowDiv);
      }
      updateSelectedCount();
    }

    function updateSelectedCount(){selectedCountEl.textContent=selectedSeats.size}

    function renderBookings(){bookingsList.innerHTML='';const active=manager.activeTickets();
      if(active.length===0) bookingsList.innerHTML='<div class="muted">No active bookings</div>';
      for(const t of active){
        const wrap=document.createElement('div');wrap.className='ticket';
        wrap.innerHTML=`<div><div style="font-weight:700">${t.movie.title} - ${t.seatId}</div><div class="muted small">${t.showtime}</div></div>`;
        const actions=document.createElement('div');actions.className='actions';
        const cancelBtn=document.createElement('button');cancelBtn.className='ghost';cancelBtn.textContent='Cancel';
        cancelBtn.addEventListener('click',()=>{
          try{const refund=manager.cancel(t.id);log(`Cancelled ${t.id} refunded ₹${refund}`);renderSeatMap();renderBookings()}catch(err){alert(err.message)}
        });
        actions.appendChild(cancelBtn);
        wrap.appendChild(actions);
        bookingsList.appendChild(wrap);
      }
    }

    // book selected seats
    bookBtn.addEventListener('click',()=>{
      const movieId=movieSelect.value;const movie=movies.find(m=>m.id==movieId);const showtime=showtimeSelect.value;const seats=[...selectedSeats];const price=Number(priceInput.value)||250;const userId='demo_user';
      if(seats.length===0){alert('Select at least 1 seat');return}
      try{
        const tickets=manager.book(movie,showtime,seats,userId,price);
        tickets.forEach(t=>log(`Booked ${t.id} ${t.seatId} ₹${t.price}`));
        renderSeatMap();renderBookings();
      }catch(err){alert(err.message);}
    });

    resetBtn.addEventListener('click',()=>{if(confirm('Reset all bookings for current showtime?')){const st=showtimeSelect.value;theater.initShow(st);theater.baseSeats.forEach(s=>theater.availability[st][s]=true);manager.tickets={};log('Reset performed');renderSeatMap();renderBookings()}})

    // when showtime or movie changes
    showtimeSelect.addEventListener('change',renderSeatMap);
    movieSelect.addEventListener('change',()=>{/* no-op for now */});

    // initial
    populateControls();renderSeatMap();renderBookings();
  </script>
</body>
</html>
